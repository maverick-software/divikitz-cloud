!function(b){var w,i,o,e=b("body"),c={base:{backgroundColor:yith_stripe_connect_info.background_color,fontSize:yith_stripe_connect_info.font_size,color:yith_stripe_connect_info.color,fontFamily:yith_stripe_connect_info.font_family,"::placeholder":{color:yith_stripe_connect_info.placeholder_color}}},t=yith_stripe_connect_info.account_id?{stripeAccount:yith_stripe_connect_info.account_id}:{},k=Stripe(yith_stripe_connect_info.public_key,t),l=k.elements();function n(){var e,t=b("#yith-stripe-connect-card-number"),n=b("#yith-stripe-connect-card-expiry"),r=b("#yith-stripe-connect-card-cvc");t.length&&(e=t.attr("placeholder"),void 0!==w&&w.destroy(),w=l.create("cardNumber",{style:c,placeholder:e}),t.replaceWith('<div id="yith-stripe-card-number" class="yith-stripe-elements-field">'),w.mount("#yith-stripe-card-number")),n.length&&(e=n.attr("placeholder"),void 0!==i&&i.destroy(),i=l.create("cardExpiry",{style:c,placeholder:e}),n.replaceWith('<div id="yith-stripe-card-expiry" class="yith-stripe-elements-field">'),i.mount("#yith-stripe-card-expiry")),r.length&&(e=r.attr("placeholder"),void 0!==o&&o.destroy(),o=l.create("cardCvc",{style:c,placeholder:e}),r.replaceWith('<div id="yith-stripe-card-cvc" class="yith-stripe-elements-field">'),o.mount("#yith-stripe-card-cvc"))}function r(e){var t,n,r,i,o,c,l,a,s,d,p,h,m,_,f,u,y,v,g;return b("input#payment_method_yith-stripe-connect").is(":checked")&&0===b("input.stripe-connect-intent").length?(t=b("form.checkout, form#order_review, form#add_payment_method"),n=b("#wc-yith-stripe-connect-cc-form, #yith-stripe-connect-cc-form"),r=b(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table, #add_payment_method"),i=(i=b(".wc-credit-card-form-card-name")).length?i.val():b("#billing_first_name").val()+" "+b("#billing_last_name").val(),o=b("#billing_email").val(),c=(u=b("#billing_country")).val(),a=(l=b("#billing_city:visible")).val(),d=(s=b("#billing_address_1:visible")).val(),p=b("#billing_address_2:visible").val(),m=(h=b("select#billing_state, input#billing_state:visible")).val(),f=(_=b("#billing_postcode:visible")).val(),y=!(!(y=b('input[name="wc-yith-stripe-connect-payment-token"]:checked')).length||"new"===y.val())&&y.val(),r.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),v=!1,g=[],(u.closest("p.form-row.validate-required").length&&u.length&&""===c||l.closest("p.form-row.validate-required").length&&l.length&&""===a||s.closest("p.form-row.validate-required").length&&s.length&&""===d||h.closest("p.form-row.validate-required").length&&h.length&&""===m||_.closest("p.form-row.validate-required").length&&_.length&&""===f)&&(v=!0,g.push("billing.fields"),""===c&&u.parents("p.form-row").addClass("error"),""===a&&l.parents("p.form-row").addClass("error"),""===d&&s.parents("p.form-row").addClass("error"),""===m&&h.parents("p.form-row").addClass("error"),""===f)&&_.parents("p.form-row").addClass("error"),v?(C({error:{code:"validation",fieldErrors:g}}),b("fieldset#wc-yith-stripe-connect-cc-form input, fieldset#wc-yith-stripe-connect-cc-form select, fieldset#yith-stripe-connect-cc-form input, fieldset#yith-stripe-connect-cc-form select").one("keydown",function(){b(this).closest("p.form-row.error").removeClass("error")}),b(document).trigger("yith-stripe-connect-card-error")):y?(n.append('<input type="hidden" class="stripe-connect-intent" name="stripe_connect_intent" value=""/>'),r.unblock(),t.submit()):(u=S({billing_details:{name:i,address:{line1:d,line2:p,city:a,state:m,country:c,postal_code:f},email:o}}),k.createPaymentMethod("card",w,u).then(function(e){e.error?C(e):(n.append('<input type="hidden" class="stripe-connect-intent" name="stripe_connect_intent" value=""/>'),n.append('<input type="hidden" class="stripe-connect-payment-method" name="stripe_connect_payment_method" value="'+e.paymentMethod.id+'"/>'),r.unblock(),t.submit())})),!1):e}function a(e){var t,n,r,i,o,c,l,a,s,d,p,h,m,_;return b("input#payment_method_yith-stripe-connect").is(":checked")&&0===b("input.stripe-connect-intent").length?(t=b("#wc-yith-stripe-connect-cc-form, #yith-stripe-connect-cc-form"),n=b("form#add_payment_method"),r=b("#add_payment_method"),i=b(".wc-credit-card-form-card-name"),o=b("#billing_email"),c=b("#billing_country"),l=b("#billing_city:visible"),a=b("#billing_address_1:visible"),s=b("#billing_address_2:visible"),d=b("select#billing_state:visible, input#billing_state:visible"),p=b("#billing_postcode:visible"),h=S({payment_method_data:{billing_details:{name:i.length?i.val():b("#billing_first_name").val()+" "+b("#billing_last_name").val(),address:{line1:a.length?a.val():"",line2:s.length?s.val():"",city:l.length?l.val():"",state:d.length?d.val():"",country:c.length?c.val():"",postal_code:p.length?p.val():""},email:o.length?o.val():""}},save_payment_method:!0}),r.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),function(e){var t=[];yith_stripe_connect_info.is_checkout&&!yith_stripe_connect_info.order&&(t=b("form.checkout").serializeArray());return b.ajax({data:function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.push({name:n,value:t[n]});return e}(t,{action:"yith_stripe_connect_refresh_intent",yith_stripe_connect_refresh_intent:yith_stripe_connect_info.refresh_intent,selected_token:e,is_checkout:yith_stripe_connect_info.is_checkout,order:yith_stripe_connect_info.order}),method:"POST",url:yith_stripe_connect_info.ajaxurl})}().then(function(e){if("undefined"!=typeof e.res&&!e.res&&"undefined"!=typeof e.error)return C(e),!1;e.intent_id,_=e.intent_secret,k.handleCardSetup(_,w,h).then(function(e){e.error?C(e):(m=("undefined"!=typeof e.paymentIntent?e.paymentIntent:e.setupIntent).id,t.append('<input type="hidden" class="stripe-connect-intent" name="stripe_connect_intent" value="'+m+'"/>'),r.unblock(),n.submit())})}),!1):e}function s(){var t,e,n=window.location.hash.match(/^#?yith-stripe-connect-confirm-pi-([^:]+):(.+)$/);!n||n.length<3||([,n,e]=n,window.location.hash="",n=n,t=e,b("form.checkout, form#order_review"),e=n.indexOf("seti")<0?"handleCardAction":"handleCardSetup",k[e](n).then(function(e){e.error?C(e):window.location=t})["catch"](function(e){console.log(e)}))}function C(e){var t=b("form.checkout, form#order_review, form#add_payment_method"),n=b("#wc-yith-stripe-connect-cc-form, #yith-stripe-connect-cc-form"),r=b(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table, #add_payment_method");if(e.error){if(b(".woocommerce-error, .stripe-token",n).remove(),e.error.message)n.prepend('<ul class="woocommerce-error">'+e.error.message+"</ul>");else if("validation"===e.error.code){for(var i=e.error.fieldErrors,o=i.length,c="",l=0;l<o;l++)c+="<li>"+yith_stripe_connect_info[i[l]]+"</li>";n.prepend('<ul class="woocommerce-error">'+c+"</ul>")}b("html, body").animate({scrollTop:b(".woocommerce-error",n).offset().top})}t.removeClass("processing").unblock(),r.unblock()}function d(){b(".stripe-connect-intent").remove()}function S(e){var t,n,r={};if("object"!=typeof e)return e;for(t in e)e.hasOwnProperty(t)&&(n="object"==typeof e[t]?S(e[t]):e[t])&&!b.isEmptyObject(n)&&(r[t]=n);return r}b(function(){n(),s(),void 0!==w&&w.addEventListener("change",C),b("form.checkout").on("checkout_place_order_yith-stripe-connect",r),b("form#order_review").on("submit",r),b("form#add_payment_method").on("submit",a),window.addEventListener("hashchange",s),e.on("checkout_error",d),e.on("updated_checkout",n),b("form.checkout, form#order_review, form#add_payment_method").on("change","#wc-yith-stripe-connect-cc-form input, #yith-stripe-connect-cc-form input",d)})}(jQuery);