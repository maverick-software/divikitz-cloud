var stripe_card,stripe_exp,stripe_cvc,stripe=Stripe(yith_stripe_connect_info.public_key),element=stripe.elements(),type="undefined"!=typeof yith_stripe_connect_source_info?yith_stripe_connect_source_info.payment_type:"token";!function(_){function t(e){return!_("form.checkout, form#order_review, form#add_payment_method").is(".add-card")&&(!_("input#payment_method_yith-stripe-connect").is(":checked")||_('input[name="wc-yith-stripe-connect-payment-token"]').length&&"new"!=_('input[name="wc-yith-stripe-connect-payment-token"]:checked').val())||0!==_("input.stripe-token").length||0!==_("input.stripe-source").size()?e:(("source"==type?((!1!==(owner_info=n())?stripe.createSource(stripe_card,n()):stripe.createSource(stripe_card)).then(r),stripe.createSource(stripe_card,n())):stripe.createToken(stripe_card)).then(r),!1)}function r(e){var r=_("form.checkout, form#order_review, form#add_payment_method"),t=_("#wc-yith-stripe-connect-cc-form, #yith-stripe-connect-cc-form");if(e.error){if(_(".woocommerce-error, .stripe-token",t).remove(),r.unblock(),e.error.message)t.prepend('<ul class="woocommerce-error">'+e.error.message+"</ul>");else if("validation"===e.error.code){for(var n=e.error.fieldErrors,i=n.length,o="",c=0;c<i;c++)o+="<li>"+yith_stripe_connect_info[n[c]]+"</li>";t.prepend('<ul class="woocommerce-error">'+o+"</ul>")}}else"source"==type?t.append('<input type="hidden" class="stripe-source" name="stripe_connect_source" value="'+e.source.id+'"/>'):t.append('<input type="hidden" class="stripe-token" name="stripe_connect_token" value="'+e.token.id+'"/>'),r.submit()}function n(){var e={owner:{address:{}}},r=_("#yith-stripe-connect-card-name").length?_("#yith-stripe-connect-card-name").val():"",t=_("#billing_first_name").length?_("#billing_first_name").val():"",n=_("#billing_last_name").length?_("#billing_last_name").val():"",i=_("#billing_email").length?_("#billing_email").val():"",o=_("#billing_phone").length?_("#billing_phone").val():"",c=_("#billing_country").length?_("#billing_country").val():"",a=_("#billing_city").length?_("#billing_city").val():"",l=_("#billing_address_1").length?_("#billing_address_1").val():"",s=_("#billing_address_2").length?_("#billing_address_2").val():"",p=_("#billing_state").length?_("#billing_state").val():"",d=_("#billing_postcode").length?_("#billing_postcode").val():"";return""!==r?e.owner.name=r:(""!==t&&(e.owner.name=t),""!==n&&(e.owner.name+=""!==t?" "+n:n)),""!==e.owner.name&&(""!==i&&(e.owner.email=i),""!==o&&(e.owner.phone=o),""!==a&&(e.owner.address.city=a),""!==c&&(e.owner.address.country=c),""!==l&&(e.owner.address.line1=l),""!==s&&(e.owner.address.line2=s),""!==d&&(e.owner.address.postal_code=d),""!==p&&(e.owner.address.state=p),e)}_(function(){var e={base:{color:"#32325d",lineHeight:"18px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},r={focus:"focused",empty:"empty",invalid:"invalid"};stripe_card=element.create("cardNumber",{style:e,classes:r}),stripe_exp=element.create("cardExpiry",{style:e,classes:r}),stripe_cvc=element.create("cardCvc",{style:e,classes:r}),_(document.body).on("updated_checkout",function(){stripe_card.mount("#yith-card-number-field-wrapper"),stripe_exp.mount("#yith-card-expiry-field-wrapper"),stripe_cvc.mount("#yith-card-cvc-field-wrapper")}),_("form.checkout").on("checkout_place_order_yith-stripe-connect",t),(0<_("form#add_payment_method").length||0<_("form#order_review").length)&&(stripe_card.mount("#yith-card-number-field-wrapper"),stripe_exp.mount("#yith-card-expiry-field-wrapper"),stripe_cvc.mount("#yith-card-cvc-field-wrapper"),_("form#add_payment_method, form#order_review").on("submit",t)),stripe_card.on("change",function(e){_("#yith-stripe-cc").attr("class","").addClass(e.brand)})})}(jQuery);