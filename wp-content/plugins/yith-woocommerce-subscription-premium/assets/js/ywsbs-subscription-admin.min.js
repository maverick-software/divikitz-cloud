jQuery(function(o){o("#ywsbs_safe_submit_field").val(""),o("#ywsbs_schedule_subscription_button").on("click",function(s){s.preventDefault(),o("#ywsbs_safe_submit_field").val("schedule_subscription"),o(this).closest("form").submit()}),0<o(document).find(".wp-heading-inline").length&&o('<div class="view-all-subs"><a href="'+ywsbs_subscription_admin.url_back_to_all_subscription+'"> < '+ywsbs_subscription_admin.back_to_all_subscription+"</a></div>").insertBefore(".wp-heading-inline"),o(document).on("click","a.edit_address",function(s){s.preventDefault();var s=o(this),i=s.closest(".subscription_data_column").find("div.edit_address"),e=s.closest(".subscription_data_column").find("a");s.closest(".subscription_data_column").find("div.address").toggle(),e.toggle(),i.toggle()});o(document).on("click",".load_customer_info",function(s){s.preventDefault();var s=o(this),i=s.data("from"),s=s.data("to"),e=i,t=s,i=void 0;if(!0===i||window.confirm(ywsbs_subscription_admin[e===t?"load_"+e:"copy_billing"])){i=o("#user_id").val();if(0===i)return void window.alert(ywsbs_subscription_admin.no_customer_selected);i={user_id:i,action:"woocommerce_get_customer_details",security:ywsbs_subscription_admin.get_customer_details_nonce};o.ajax({url:ywsbs_subscription_admin.ajaxurl,data:i,type:"POST",success:function(s){console.log(s),s&&s[e]&&o.each(s[e],function(s,i){o("#_"+t+"_"+s).val(i).change()})}})}}),o.fn.datetimepicker!==undefined&&o(document).find(".ywsbs-timepicker").each(function(){o(this).prop("placeholder","YYYY-MM-DD HH:mm")}).datetimepicker({timeFormat:"HH:mm:ss",defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showSeconds:!1}),o(document).find(".ui-datepicker").addClass("yith-plugin-fw-datepicker-div"),o("#ywsbs_schedule_subscription_button").on("click",function(s){s.preventDefault(),o("#ywsbs_safe_submit_field").val("schedule_subscription"),o(this).closest("form").submit()});var i={init:function(){var s=o(document).find("#woocommerce-order-items");s.on("click","a.edit-order-item",this.edit_item),s.on("click",".save-action",this.save_items),s.on("click",".recalculate-action",this.recalculate)},edit_item:function(){return o(this).closest("tr").find(".view").hide(),o(this).closest("tr").find(".edit").show(),o(this).hide(),o(".wc-order-add-item").show(),o(".wc-order-recalculate").hide(),o("button.cancel-action").attr("data-reload",!0),!1},save_items:function(){var s={subscription_id:o("#post_ID").val(),items:o("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),action:"ywsbs_save_items",security:ywsbs_subscription_admin.save_item_nonce};return o.ajax({url:ywsbs_subscription_admin.ajaxurl,data:s,type:"POST",beforeSend:function(){o("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(s){o("#ywsbs-product-subscription").find(".inside").empty().append(s),o("#woocommerce-order-items").unblock(),i.init()}}),!1},recalculate:function(){var s={subscription_id:o("#post_ID").val(),action:"ywsbs_recalculate",security:ywsbs_subscription_admin.recalculate_nonce};o.ajax({url:ywsbs_subscription_admin.ajaxurl,data:s,type:"POST",beforeSend:function(){o("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(s){o("#ywsbs-product-subscription").find(".inside").empty().append(s),o("#woocommerce-order-items").unblock(),i.init()}})}};function t(){return o(document).find(".ywsbs-delivery-schedules-table").DataTable({searching:!0,ordering:!1,language:{lengthMenu:ywsbs_subscription_admin.datatable_lengthMenu+" _MENU_"}})}i.init(),0<o(".ywsbs-export").length&&(o(".wp-header-end").before(o(".ywsbs-export")),o(".ywsbs-export").css({display:"inline-block"}));var n=t(),c=(o(document).on("change","#ywsbs-delivery-schedules-status",function(){n.columns(1).search(this.value).draw()}),function(s,e){o.ajax({url:ywsbs_subscription_admin.ajaxurl,data:s,type:"POST",beforeSend:function(){e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(s){var i;"undefined"==typeof s.error&&(i=o("#ywsbs-delivery-schedules-status").val(),e.unblock(),e.closest(".inside").html(s),n.destroy,n=t(),i&&o("#ywsbs-delivery-schedules-status").val(i).change())}})});o(document).on("change",".status-hover",function(){var s=o(this),i=s.val(),e=s.closest(".status-td"),s=e.data("id"),t=o("#yith-shipped-confirm"),n={action:"ywsbs_update_delivery_status",security:ywsbs_subscription_admin.delivery_nonce,deliveryID:s,status:i,subscriptionID:o("#post_ID").val()},s={};s[ywsbs_subscription_admin["continue"]]=function(){c(n,e),t.dialog("close")},s[ywsbs_subscription_admin.cancel]=function(){t.dialog("close")},"shipped"===i?t.dialog({width:450,modal:!0,dialogClass:"ywsbs-shipped-confirm",buttons:s}):c(n,e)}),o(document).on("click",".remove-coupon",function(){var s=o(this),i=s.data("code"),s=(o("#ywsbs-product-subscription").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),{action:"ywsbs_remove_subscription_coupon",dataType:"json",subscription_id:o("#post_ID").val(),security:s.data("nonce"),coupon:i});o.post(ywsbs_subscription_admin.ajaxurl,s,function(s){s.success?o("#ywsbs-product-subscription").find(".inside").empty().append(s.data.html):window.alert(s.data.error),o("#ywsbs-product-subscription").unblock()})}),o(document).on("click",".add-coupon",function(){var s=o(this),i=window.prompt(ywsbs_subscription_admin.add_coupon_text);return null!==i&&(o("#ywsbs-product-subscription").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s={action:"ywsbs_add_subscription_coupon",dataType:"json",subscription_id:o("#post_ID").val(),security:s.data("nonce"),coupon:i.trim(),user_id:o("#user_id").val(),user_email:o("#_billing_email").val()},o.post(ywsbs_subscription_admin.ajaxurl,s,function(s){s.success?o("#ywsbs-product-subscription").find(".inside").empty().append(s.data.html):window.alert(s.data.error),o("#ywsbs-product-subscription").unblock()})),!1})});